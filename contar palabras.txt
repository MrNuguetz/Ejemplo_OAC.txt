%include "./pc_io.inc" 

section .data
msg: db 'ingrese un texto : ',0
msg2: db 'ingrese el caracter a buscar: ',0
tabla db '0','1','2','3','4','5','6','7','8','9'
len: equ $- msg

section .bss
texto resb 100
caracter resb 1
contador resb 20
;cad resb 10

section .text

global _start
_start:

mov edx, msg
call puts


call capturar
call salto

call captura_caracter
call salto

mov ebx,tabla
call comprobar
call salto

call imprimir
call salto

mov eax,1
mov ebx,0
int 80h


capturar: 
    pushad
    mov esi,0

    ciclocap:
        
        call getche
        cmp al,'*'
        je fin1
        mov byte[edx+esi],al    
        inc esi
        jmp ciclocap
    fin1 : 
        mov byte[edx+esi],'*'
        popad
        ret

captura_caracter:
    pushad
    mov edx,msg2
    call puts  
    call getche
    mov byte[caracter],al
    je salir

    salir:
    popad
    ret

comprobar:pushad
        mov byte[contador],0
        mov esi,0
        mov ah,byte[caracter]

        ciclo:
            mov  al,byte[edx+esi]
            cmp al,'*'
            je fin2
            cmp ah,al
            je contar
            je siguiente

            siguiente:
            inc esi
            jmp ciclo

            contar:
            inc byte[contador]
            inc esi
            jmp ciclo

            fin2:
            popad
            ret

imprimir:pushad

    mov al,byte[contador]
    xlat
    call putchar
    popad
    ret

salto:
    pushad
    mov al,13
    call putchar
    mov al,10
    call putchar
    popad
    ret
 