%include "./pc_io.inc" 

section .data

msg : db 'ingrese una cadena binaria de 4 bits' ,0x0
tabla: db '1','2','4','8'


section .bss
cadena resb 1
acumulador resb 20
auxiliar resb 20


cad resb 8

section .text


global _start

_start:

mov edx,msg
call putchar

mov edx,cadena
call capturar
call salto
call calcular
call salto

call imprimir
call salto



mov eax,1
mov ebx,0
int 80h


capturar:
    push edx
    push eax
    mov esi,0

    ciclo:
        call getche
        cmp al,'*'
        je fin1
        sub al,'0'
        mov byte[edx+esi],al
        inc esi
        jmp ciclo
  
    fin1:
    pop eax
    pop edx
    ret

calcular:
    mov ecx,0
    ciclocap:
    mov al,byte[eax+esi]
    cmp al,0
    je brinco
    cmp al,1
    je cambio
    dec esi
    inc ecx
    mov [auxiliar],ecx
    jmp ciclocap

    brinco:
    dec esi
    jmp ciclocap

    cambio:
    mov al,2
    cambio2:
        MUL byte[auxiliar]
        add word[acumulador],ax
        loop cambio2

    jmp ciclocap


imprimir:
    mov esi,cad
    mov eax,acumulador
    call printHex8
    ret






;en eax el valor a convertir mostrar en hexadecimal
printHex8:
  pushad
  mov edx, eax
  mov ebx, 0fh
  mov cl, 28
.nxt: shr eax,cl
.msk: and eax,ebx
  cmp al, 9
  jbe .menor
  add al,7
.menor:add al,'0'
  mov byte [esi],al
  inc esi
  mov eax, edx
  cmp cl, 0
  je .print
  sub cl, 4
  cmp cl, 0
  ja .nxt
  je .msk
.print: mov eax, 4
  mov ebx, 1
  sub esi, 8
  mov ecx, esi
  mov edx, 8
  int 80h
  popad
  ret




salto:
    pushad
    mov al,13
    call putchar
    mov al,10
    call putchar
    popad
    ret
    ret