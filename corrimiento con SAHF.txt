%include "./pc_io.inc" 

section .data
msg: db 'ingrese un texto : ',0
len: equ $- msg

section .bss
texto resb 100
contador resb 1
cad resb 10

section .text

global _start
_start:


mov edx, msg
call puts

mov edx,texto

call capturar
call salto
mov edx, texto
call imprimir
call salto

mov eax,1
mov ebx,0
int 80h

capturar: 
     pushad
    mov esi,0
    ciclocap:
        
        call getche
        cmp al,'*'
        je fin1
        mov byte[edx+esi],al
        inc esi
        jmp ciclocap
    fin1 : 
        mov byte[edx+esi],'*'
        popad
        ret
        

imprimir:
    pushad

    mov esi,0
    mov byte[contador],0

.adomos:
        mov al,[edx+esi]
        cmp al,'*'
        je .fin2
        cmp al,' '
        je .contar_espacio
        jmp .siguiente

        .contar_espacio:
        inc byte[contador]
        jmp .siguiente

        
.siguiente:
    inc esi
    jmp .adomos


.fin2 : 
        
        mov esi,cad
        inc byte[contador]
        movzx eax,byte[contador]
        call printHex
        popad
        ret

salto:
    pushad
    mov al,13
    call putchar
    mov al,10
    call putchar
    popad
    ret
    

    ;en eax el valor a convertir mostrar en hexadecimal
printHex:
  pushad
  mov edx, eax
  mov ebx, 0fh
  mov cl, 28
.nxt: shr eax,cl
.msk: and eax,ebx
  cmp al, 9
  jbe .menor
  add al,7
.menor:add al,'0'
  mov byte [esi],al
  inc esi
  mov eax, edx
  cmp cl, 0
  je .print
  sub cl, 4
  cmp cl, 0
  ja .nxt
  je .msk
.print: mov eax, 4
  mov ebx, 1
  sub esi, 8
  mov ecx, esi
  mov edx, 8
  int 80h
  popad
  ret